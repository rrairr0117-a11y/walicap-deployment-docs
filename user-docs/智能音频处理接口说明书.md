# 智能音频处理接口说明书

**接口地址**: `POST /v1/audio-mixing`  
**功能**: 将主音轨(人声/视频)与背景音乐进行混合，支持多首BGM拼接、智能音效插入。

---

## 完整参数清单

### 1. 主音轨 (必填)
| 参数名 | 必填 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| `video_url` | 是 | string | 主音轨URL<br>(可以是纯音频，也可以是视频文件) | `"http://oss.com/voice.mp3"` |

### 2. 背景音乐 (必填)
| 参数名 | 必填 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| `audio_url` | 是 | 多格式 | **支持3种格式**：<br>1. 单个URL字符串<br>2. URL数组(按顺序拼接)<br>3. S3对象(自动读取文件夹) | 见下方详解 |
| `bgm_vol` | 否 | float | 背景音音量<br>范围: 0.0-1.0<br>默认: 0.3 | `0.4` |
| `bgm_mode` | 否 | string | 多首BGM播放模式<br>`sequential`: 顺序播放<br>`random`: 随机播放<br>默认: `sequential` | `"sequential"` |

#### `audio_url` 的三种格式：

**格式1: 单个URL**
```json
"audio_url": "http://oss.com/bgm.mp3"  // 背景音乐文件链接
```

**格式2: URL数组**
```json
"audio_url": [  // 多首BGM，系统会按顺序自动拼接
    "http://oss.com/bgm1.mp3",
    "http://oss.com/bgm2.mp3",
    "http://oss.com/bgm3.mp3"
]
```

**格式3: S3文件夹**
```json
"audio_url": {
    "bucket": "my-music-bucket",  // S3存储桶名称
    "prefix": "bgm_folder/"       // 文件夹路径，系统自动读取里面所有音频
}
```

### 3. 智能音效 (可选)
| 参数名 | 必填 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| `smart_director` | 否 | bool | 是否开启智能音效插入<br>默认: `false` | `true` |
| `director_config` | 见下 | object | 智能音效配置对象 | `{...}` |
| `sfx_vol` | 否 | float | 音效音量<br>范围: 0.0-1.0<br>默认: 0.6 | `0.8` |

#### `director_config` 内部参数
仅当 `smart_director=true` 时，此对象才需要填写。

| 子参数名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `srt_content` | string | **SRT字幕内容**(纯文本，不是URL)<br>AI通过分析字幕决定插入什么音效 |
| `sfx_bucket` | string | 音效库所在S3 Bucket名称 |
| `sfx_prefix` | string | 音效库文件夹路径 |

### 4. 输出控制 (可选)
| 参数名 | 必填 | 类型 | 说明 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| `output_length` | 否 | string | 输出时长基准<br>`video`: 以主音轨时长为准<br>`audio`: 以背景音时长为准 | `"video"` |
| `output_duration` | 否 | float | 强制指定输出时长(秒)<br>会截断或循环素材 | `120.5` |

### 5. 异步回调 (可选)
| 参数名 | 必填 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| `webhook_url` | 否 | string | 任务完成后的回调地址 |
| `id` | 否 | string | 自定义任务ID |

---

## 完整请求示例

### 示例1: 基础混音 (单BGM - 最简版)
```json
{
    "video_url": "http://oss.com/narration.mp3",  // 【必填】主人声/解说音频
    "audio_url": "http://oss.com/bgm.mp3"         // 【必填】背景音乐
}
```

### 示例2: 多BGM拼接
```json
{
    "video_url": "http://oss.com/voice.mp3",  // 【必填】主人声
    "audio_url": [                            // 【必填】3首BGM，系统按顺序拼接
        "http://oss.com/intro.mp3",           // 第1首：开场音乐
        "http://oss.com/main.mp3",            // 第2首：主体音乐
        "http://oss.com/outro.mp3"            // 第3首：结尾音乐
    ],
    "bgm_mode": "sequential",                 // 【可选】播放模式 (sequential顺序/random随机, 默认sequential)
    "bgm_vol": 0.4                            // 【可选】背景音音量 (范围0.0-1.0, 默认0.3)
}
```

### 示例3: 智能音效插入 (完整功能版)
```json
{
    // ===== 任务标识 (可选) =====
    "id": "job_horror_001",                      // 【可选】自定义任务ID
    "webhook_url": "https://callback.com/api",   // 【可选】任务完成后回调此地址

    // ===== 主音轨 (必填) =====
    "video_url": "http://oss.com/horror_story.mp3",  // 【必填】主人声/视频文件

    // ===== 背景音乐 (必填) =====
    "audio_url": {                            // 【必填】从S3文件夹读取所有BGM
        "bucket": "my-assets",                // S3存储桶名称
        "prefix": "bgm/horror/"               // BGM文件夹路径 (系统自动读取里面所有音频)
    },
    "bgm_vol": 0.2,                           // 【可选】背景音音量 (20%, 默认0.3)
    "bgm_mode": "random",                     // 【可选】随机播放 (默认sequential顺序)

    // ===== 智能音效配置 (可选) =====
    "smart_director": true,                   // 【可选】🟢 开启智能音效插入 (默认false)
    "director_config": {                      // 【可选】智能音效配置对象 (仅当smart_director=true时需要)
        // AI的剧本 (字幕文本，AI会分析内容并自动匹配音效)
        "srt_content": "1\n00:00:01,000 --> 00:00:05,000\n突然，门外传来了敲门声\n\n2\n00:00:06,000 --> 00:00:10,000\n脚步声越来越近...\n",
        
        // 音效库位置 (AI从这里挑选音效)
        "sfx_bucket": "my-assets",            // 音效库S3存储桶
        "sfx_prefix": "sfx/horror/"           // 音效库文件夹路径
    },
    "sfx_vol": 0.8,                           // 【可选】音效音量 (80%, 默认0.6)

    // ===== 输出控制 (可选) =====
    "output_length": "video",                 // 【可选】输出时长基准 (video以主音轨为准/audio以BGM为准)
    "output_duration": 120.0                  // 【可选】强制指定输出时长(秒), 会截断或循环素材
}
```

### 示例4: 终极完整版 (包含所有可选参数)
```json
{
    // ===== 必填参数 =====
    "video_url": "http://oss.com/main_voice.mp3",  // 【必填】主音轨 (人声或视频)
    "audio_url": "http://oss.com/bgm.mp3",         // 【必填】背景音乐

    // ===== 背景音控制 (可选) =====
    "bgm_vol": 0.35,                          // 【可选】背景音音量, 范围0.0-1.0, 默认0.3
    "bgm_mode": "sequential",                 // 【可选】BGM播放模式 (sequential顺序/random随机), 默认sequential

    // ===== 智能音效 (可选) =====
    "smart_director": true,                   // 【可选】是否开启智能音效插入, 默认false
    "director_config": {                      // 【可选】智能音效配置 (smart_director=true时必填)
        "srt_content": "1\n00:00:00,500 --> 00:00:03,000\n开场白...\n",  // SRT字幕文本 (AI剧本)
        "sfx_bucket": "my-sfx-bucket",        // 音效库S3存储桶
        "sfx_prefix": "effects/"              // 音效库文件夹路径
    },
    "sfx_vol": 0.7,                           // 【可选】音效音量, 范围0.0-1.0, 默认0.6

    // ===== 输出控制 (可选) =====
    "output_length": "video",                 // 【可选】时长基准 (video主音轨/audio背景音), 不填则自动
    "output_duration": 180.5,                 // 【可选】强制输出时长(秒), 会截断或循环, 不填则由output_length决定

    // ===== 异步回调 (可选) =====
    "webhook_url": "https://my.com/callback", // 【可选】任务完成后回调地址
    "id": "custom_job_123"                    // 【可选】自定义任务ID
}
```

---

## 返回结果
任务提交成功后返回云端文件URL：
```json
{
    "status": "success",
    "file_url": "https://s3.../mixed_audio_xxxx.mp3"
}
```

---

## 注意事项
1.  实际使用时请**删除所有注释** (JSON标准不支持 `//` 注释)。
2.  `srt_content` 必须是**完整的SRT字幕文本**，不能是URL。
3.  智能音效需要同时提供 `srt_content` (剧本) 和 `sfx_bucket/prefix` (音效库)，缺一不可。
