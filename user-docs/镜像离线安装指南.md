# ç“¦åŠ›èšåˆå‰ªè¾‘ç³»ç»Ÿ - Docker é•œåƒç¦»çº¿å®‰è£…æŒ‡å—

> ğŸ“¦ é€‚ç”¨äºæ— æ³•è®¿é—®é˜¿é‡Œäº‘é•œåƒä»“åº“æˆ–ç½‘ç»œå—é™çš„ç¯å¢ƒ

---

## ğŸ“‹ æ–‡ä»¶è¯´æ˜

### é•œåƒæ–‡ä»¶

| æ–‡ä»¶å | ç‰ˆæœ¬ | å¤§å° | è¯´æ˜ |
|--------|------|------|------|
| `walicap-v2.1cuda-docker-image.tar` | v2.1cuda | ~10GB | GPU ç‰ˆæœ¬ï¼ˆæ¨èï¼‰ |
| `walicap-v2.0-docker-image.tar` | v2.0 | ~3GB | CPU ç‰ˆæœ¬ |

**ä¸‹è½½åœ°å€**ï¼š
- å¤¸å…‹ç½‘ç›˜ï¼š`é“¾æ¥: https://pan.quark.cn/s/4a6aab126d35 æå–ç : /~67b139XHH7~:/`
- æ–‡ä»¶å¤§å°ï¼š9.35 GB
- MD5 æ ¡éªŒï¼š`a75a446660622cfb3d7bba9dcde1f51a`

---

## ğŸš€ å®‰è£…æ­¥éª¤

### æ­¥éª¤ 1: ä¸‹è½½é•œåƒæ–‡ä»¶

ä»å¤¸å…‹ç½‘ç›˜ä¸‹è½½é•œåƒæ–‡ä»¶åˆ°æœ¬åœ°ï¼š

1. è®¿é—®é“¾æ¥ï¼šhttps://pan.quark.cn/s/4a6aab126d35
2. è¾“å…¥æå–ç ï¼š`/~67b139XHH7~:/`
3. ä¸‹è½½æ–‡ä»¶ï¼š`walicap-v2.1cuda-docker-image.tar`ï¼ˆ9.35 GBï¼‰

**å»ºè®®**ï¼šä¸‹è½½åˆ°ä¸€ä¸ªå®¹æ˜“æ‰¾åˆ°çš„ç›®å½•ï¼Œå¦‚ `D:\docker-images\` æˆ– `~/docker-images/`

### æ­¥éª¤ 2: éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆæ¨èï¼‰

åŠ è½½å‰å…ˆéªŒè¯æ–‡ä»¶æ˜¯å¦å®Œæ•´ä¸‹è½½ï¼š

#### Windows (PowerShell)
```powershell
# è¿›å…¥æ–‡ä»¶æ‰€åœ¨ç›®å½•
cd D:\docker-images

# è®¡ç®— MD5 å€¼
certutil -hashfile walicap-v2.1cuda-docker-image.tar MD5
```

#### Linux / macOS
```bash
# è¿›å…¥æ–‡ä»¶æ‰€åœ¨ç›®å½•
cd ~/docker-images

# è®¡ç®— MD5 å€¼
md5sum walicap-v2.1cuda-docker-image.tar
```

**æ­£ç¡®çš„ MD5 å€¼**ï¼š`a75a446660622cfb3d7bba9dcde1f51a`

å¦‚æœ MD5 å€¼ä¸åŒ¹é…ï¼Œè¯·é‡æ–°ä¸‹è½½æ–‡ä»¶ã€‚

### æ­¥éª¤ 3: åŠ è½½é•œåƒåˆ° Docker

æ‰“å¼€ç»ˆç«¯/å‘½ä»¤è¡Œï¼Œè¿›å…¥é•œåƒæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š

#### Windows (PowerShell)
```powershell
# è¿›å…¥æ–‡ä»¶æ‰€åœ¨ç›®å½•
cd D:\docker-images

# åŠ è½½é•œåƒï¼ˆæ³¨æ„æ–‡ä»¶åè¦å®Œå…¨åŒ¹é…ï¼‰
docker load -i walicap-v2.1cuda-docker-image.tar
```

#### Linux / macOS
```bash
# è¿›å…¥æ–‡ä»¶æ‰€åœ¨ç›®å½•
cd ~/docker-images

# åŠ è½½é•œåƒ
docker load -i walicap-v2.1cuda-docker-image.tar
```

**é¢„è®¡æ—¶é—´**ï¼šæ ¹æ®æ–‡ä»¶å¤§å°ï¼Œéœ€è¦ 2-5 åˆ†é’Ÿ

**é¢„æœŸè¾“å‡º**ï¼š
```
Loaded image: crpi-gpb2zeuxu5n5h1lc.cn-chengdu.personal.cr.aliyuncs.com/rrairr/walicap:v2.1cuda
```

### æ­¥éª¤ 4: éªŒè¯é•œåƒåŠ è½½æˆåŠŸ

#### Windows (PowerShell)
```powershell
docker images | Select-String "walicap"
```

#### Linux / macOS
```bash
docker images | grep walicap
```

**é¢„æœŸè¾“å‡º**ï¼š
```
crpi-gpb2zeuxu5n5h1lc.cn-chengdu.personal.cr.aliyuncs.com/rrairr/walicap   v2.1cuda   65280eccc9de   28.7GB
```

**é‡è¦**ï¼šç¡®è®¤é•œåƒåç§°å®Œæ•´ä¸º `crpi-gpb2zeuxu5n5h1lc.cn-chengdu.personal.cr.aliyuncs.com/rrairr/walicap:v2.1cuda`ï¼Œè¿™ä¸ docker-compose.yml ä¸­çš„é…ç½®ä¸€è‡´ã€‚

### æ­¥éª¤ 5: ä¸‹è½½éƒ¨ç½²é…ç½®æ–‡ä»¶

ä» GitHub ä¸‹è½½éƒ¨ç½²æ–‡ä»¶ï¼š

```bash
git clone https://github.com/rrairr0117-a11y/walicap-deployment-docs.git
cd walicap-deployment-docs
```

**æˆ–è€…**æ‰‹åŠ¨ä¸‹è½½ï¼š
1. è®¿é—® https://github.com/rrairr0117-a11y/walicap-deployment-docs
2. ç‚¹å‡» `Code` â†’ `Download ZIP`
3. è§£å‹åˆ°æœ¬åœ°ç›®å½•

### æ­¥éª¤ 6: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.nca.local.example .env.nca.local

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥æˆæƒä¿¡æ¯
# Windows: notepad .env.nca.local
# Linux/Mac: nano .env.nca.local
```

**å¿…å¡«é…ç½®é¡¹**ï¼š
```bash
API_KEY=your_api_key_here
LICENSE_API_SECRET=sk-your_license_api_secret
LICENSE_PRODUCT_ID=65
LICENSE_KEY=LIC_your_license_key
LICENSE_USERNAME=your_username
```

> ğŸ’¡ æˆæƒä¿¡æ¯è¯·ä» https://rrairr.cn è´­ä¹°åè·å–

### æ­¥éª¤ 7: éªŒè¯ docker-compose.yml é…ç½®

**é‡è¦**ï¼šç¡®è®¤ `docker-compose.yml` ä¸­çš„é•œåƒåç§°ä¸åŠ è½½çš„é•œåƒä¸€è‡´ã€‚

æ‰“å¼€ `docker-compose.yml` æ–‡ä»¶ï¼Œæ‰¾åˆ°ç¬¬ 40 è¡Œå·¦å³ï¼š

```yaml
services:
  ncat:
    # ç¡®è®¤è¿™è¡Œçš„é•œåƒåç§°
    image: crpi-gpb2zeuxu5n5h1lc.cn-chengdu.personal.cr.aliyuncs.com/rrairr/walicap:v2.1cuda
```

**é•œåƒåç§°å¿…é¡»å®Œå…¨åŒ¹é…**ï¼š
- âœ… æ­£ç¡®ï¼š`crpi-gpb2zeuxu5n5h1lc.cn-chengdu.personal.cr.aliyuncs.com/rrairr/walicap:v2.1cuda`
- âŒ é”™è¯¯ï¼š`walicap:v2.1cuda`ï¼ˆç¼ºå°‘ä»“åº“åœ°å€ï¼‰

å¦‚æœä¸ä¸€è‡´ï¼Œè¯·ä¿®æ”¹ä¸ºæ­£ç¡®çš„é•œåƒåç§°ã€‚

### æ­¥éª¤ 8: å¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

### æ­¥éª¤ 9: éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f ncat

# æµ‹è¯• API
curl http://localhost:8080/v1/toolkit/test
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "status": "success",
  "message": "NCA Toolkit API is running"
}
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: åŠ è½½é•œåƒæ—¶æç¤º "no space left on device"

**åŸå› **ï¼šç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†æœªä½¿ç”¨çš„ Docker èµ„æº
docker system prune -a

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

### Q2: åŠ è½½é•œåƒæ—¶æç¤º "invalid tar header"

**åŸå› **ï¼šä¸‹è½½æ–‡ä»¶æŸåæˆ–ä¸å®Œæ•´

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é‡æ–°ä¸‹è½½é•œåƒæ–‡ä»¶
2. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆMD5 å€¼åº”ä¸º `a75a446660622cfb3d7bba9dcde1f51a`ï¼‰

### Q3: GPU ç‰ˆæœ¬æ— æ³•ä½¿ç”¨ GPU

**åŸå› **ï¼šæœªå®‰è£… nvidia-docker

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®‰è£… nvidia-dockerï¼ˆLinuxï¼‰
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update && sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker

# éªŒè¯ GPU å¯ç”¨
docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
```

### Q4: å®¹å™¨å¯åŠ¨å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. ç¡®è®¤ `.env.nca.local` æ–‡ä»¶å·²æ­£ç¡®é…ç½®
2. æ£€æŸ¥ç«¯å£ 8080ã€9000ã€9001 æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`docker-compose logs ncat`

---

## ğŸ” æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ

ä¸ºç¡®ä¿ä¸‹è½½çš„é•œåƒæ–‡ä»¶å®Œæ•´ï¼Œå¯ä»¥éªŒè¯ MD5 å€¼ï¼š

### GPU ç‰ˆæœ¬ (v2.1cuda)
```bash
# Windows
certutil -hashfile walicap-v2.1cuda-docker-image.tar MD5

# Linux/Mac
md5sum walicap-v2.1cuda-docker-image.tar
```

**æ­£ç¡®çš„ MD5 å€¼**ï¼š`å¾…æ›´æ–°`

### CPU ç‰ˆæœ¬ (v2.0)
```bash
# Windows
certutil -hashfile walicap-v2.0-docker-image.tar MD5

# Linux/Mac
md5sum walicap-v2.0-docker-image.tar
```

**æ­£ç¡®çš„ MD5 å€¼**ï¼š`å¾…æ›´æ–°`

---

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | GPU ç‰ˆæœ¬ (v2.1cuda) | CPU ç‰ˆæœ¬ (v2.0) |
|------|---------------------|-----------------|
| æ–‡ä»¶å¤§å° | ~10GB | ~3GB |
| å†…å­˜è¦æ±‚ | 16GB+ | 8GB+ |
| GPU è¦æ±‚ | NVIDIA GPU + nvidia-docker | æ—  |
| è½¬å†™é€Ÿåº¦ | å¿« 10 å€ | æ ‡å‡† |
| é€‚ç”¨åœºæ™¯ | ç”Ÿäº§ç¯å¢ƒã€å¤§æ‰¹é‡å¤„ç† | æµ‹è¯•ç¯å¢ƒã€å°æ–‡ä»¶ |
| æ¨èåº¦ | â­â­â­â­â­ | â­â­â­ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒ
- âœ… ä½¿ç”¨ GPU ç‰ˆæœ¬ (v2.1cuda)
- âœ… é…ç½®è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 50GBï¼‰
- âœ… å®šæœŸå¤‡ä»½ MinIO æ•°æ®ç›®å½•

### æµ‹è¯•ç¯å¢ƒ
- âœ… å¯ä½¿ç”¨ CPU ç‰ˆæœ¬ (v2.0)
- âœ… å°æ–‡ä»¶æµ‹è¯•å³å¯

### ç½‘ç»œå—é™ç¯å¢ƒ
- âœ… æå‰ä¸‹è½½é•œåƒæ–‡ä»¶
- âœ… å†…ç½‘éƒ¨ç½²æ—¶ä½¿ç”¨ç¦»çº¿å®‰è£…æ–¹å¼

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸŒ å®˜ç½‘ï¼šhttps://rrairr.cn
- ğŸ“§ é‚®ç®±ï¼šsupport@rrairr.cn
- ğŸ“– æ–‡æ¡£ï¼šhttps://github.com/rrairr0117-a11y/walicap-deployment-docs

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.1cuda (2025-12-09)
- âœ… æ”¯æŒ NVIDIA GPU åŠ é€Ÿ
- âœ… éŸ³é¢‘è½¬å†™é€Ÿåº¦æå‡ 10 å€
- âœ… ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- âœ… ä¿®å¤å·²çŸ¥é—®é¢˜

### v2.0 (2025-12-06)
- âœ… åˆå§‹ CPU ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®Œæ•´åŠŸèƒ½æ”¯æŒ

---

**ğŸ‰ ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼**
