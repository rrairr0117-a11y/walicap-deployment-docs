# NCA Toolkit 本地环境配置文件
# 使用方法：复制为 .env.nca.local 文件


# ==================== 应用基础配置 ====================
APP_NAME=NCAToolkit
APP_DEBUG=true
APP_DOMAIN=localhost:8080
APP_URL=http://localhost:8080

# API认证密钥 - 请修改为你的安全密钥
API_KEY=your_api_key_here

# ==================== MinIO S3兼容存储配置（可选云存储）====================
# 说明：
# - 从架构设计上看，如果你不配置任何 S3/GCP 相关变量，部分接口可以只使用 LOCAL_STORAGE_PATH 的本地临时目录；
# - 本文件是「NCA + MinIO」本地开发示例，因此默认启用 MinIO 作为对象存储；
# - 如果你只想本地模式（不上传到云存储），可以将下面 S3_* 行注释掉，并在调用接口时使用 cloud_upload=false，仅返回本地文件路径。
# MinIO 服务配置（容器内访问地址）
S3_ENDPOINT_URL=http://minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin123
S3_REGION=us-east-1
S3_BUCKET_NAME=nca-toolkit-local

# ==================== 性能调优配置 ====================
# 队列管理
MAX_QUEUE_LENGTH=20

# Gunicorn工作进程配置
GUNICORN_WORKERS=4
GUNICORN_TIMEOUT=600

# ==================== 本地存储配置 ====================
# 临时文件存储路径
LOCAL_STORAGE_PATH=/tmp

# ==================== 日志配置 ====================
# 日志级别：debug, info, warning, error
LOG_LEVEL=info

# ==================== N8N集成配置 ====================
# N8N Webhook基础URL（供NCA回调使用）
N8N_WEBHOOK_BASE_URL=http://n8n-local:5678

# ==================== 网络代理配置（可选）====================
# 如果需要代理访问外部资源，取消注释并配置
# HTTP_PROXY=http://host.docker.internal:10809
# HTTPS_PROXY=http://host.docker.internal:10809
# NO_PROXY=localhost,127.0.0.1,minio,n8n-local

# ==================== 翻译服务配置 ====================
# 翻译服务选择：youdao（有道翻译，推荐）或 aws（AWS Translate）
TRANSLATE_SERVICE=youdao

# 有道智云翻译配置（推荐，每天1000次免费）
# 申请地址：https://ai.youdao.com/
YOUDAO_APP_ID=your_youdao_app_id
YOUDAO_APP_KEY=your_youdao_app_key

# AWS 服务配置（备选，用于 TTS/文本翻译）
# 仅在需要使用以下接口时才需要配置：
# - /v1/audio/tts/*  （AWS Polly 文本转语音）
# - /v1/text/translate （AWS Translate 文本翻译）
# - /v1/video/sync-audio-video （手动SRT翻译功能）
# 不配置时，上述接口将不可用，但其他本地/存储相关接口不受影响。
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_REGION=ap-southeast-1

# ==================== FunASR 语音识别配置（可选）====================
# 如果将 TRANSCRIBE_ENGINE 设置为 funasr，需要同时配置以下变量；
# 默认 TRANSCRIBE_ENGINE=whisper，无需配置 FunASR 相关项。
TRANSCRIBE_ENGINE=funasr
FUNASR_API_BASE_URL=http://host.docker.internal:5000
#FUNASR_API_KEY=your_funasr_api_key
FUNASR_POLL_INTERVAL=30.0
FUNASR_MAX_POLL_SECONDS=3600

# ==================== 授权验证配置（可选）====================
# 授权验证系统会自动启用（当配置了 LICENSE_API_SECRET 和 LICENSE_PRODUCT_ID 时）
# 支持单设备登录限制（基于 Docker 容器 ID）
# 默认使用 API_KEY 认证模式
LICENSE_API_URL=https://rrairr.cn/api/software-license
LICENSE_API_SECRET=sk-your_license_api_secret_here
LICENSE_PRODUCT_ID=65
LICENSE_KEY=LIC_your_license_key_here
LICENSE_USERNAME=your_username

# 使用说明：
# 1. 在 rrairr.cn 后台创建"瓦力聚合剪辑系统"产品
# 2. 获取产品 ID、API Secret 和授权码
# 3. 取消上面配置的注释并填入真实值
# 4. 程序会自动检测并启用授权验证（无需手动设置开关）
# 5. 用户可以通过请求头使用授权码：
#    curl -H "X-License-Key: LIC_ABC123_XYZ789" http://localhost:8080/v1/video/caption
# 6. 同时保持 API_KEY 兼容（向后兼容）：
#    curl -H "X-API-Key: nca-local-dev-key-2024" http://localhost:8080/v1/video/caption
# 7. 单设备限制：同一授权码只能在一个 Docker 容器中使用
# 8. 启动时会显示授权状态、剩余天数、到期时间等信息

# 本地开发建议：
# - 开发环境：注释掉授权配置，使用 API_KEY
# - 生产环境：取消注释并填入真实授权配置

# 
# 单设备限制机制：
# - 后门密钥会发送到服务器验证设备绑定（与授权码相同的服务器）
# - 首次使用时，服务器记录容器ID并绑定
# - 再次使用时，服务器检查容器ID是否匹配
# - 绕过授权验证（不检查是否过期、是否付费）
# - 但仍然检查设备绑定（单设备限制）
# - 如需更换容器，在 rrairr.cn 后台解绑设备
# - 例如：团队成员A用 wali-7k2m9x，成员B用 wali-3n8p5q，互不冲突
# 
# 服务器端点：POST /api/software-license/verify-backdoor/{product_id}
# 请求数据：{"backdoor_key": "...", "device_id": "容器ID"}
# 返回：{"valid": true/false, "is_first_use": true/false}
