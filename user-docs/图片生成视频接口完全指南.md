# Lo-Fi 视频与图片视频接口文档

## 1. Lo-Fi 长视频生成

**接口路径**: `POST /v1/video/lofi`

**功能**: 创建 Lo-Fi 风格长时间视频，支持多张图片在时间轴均分显示，支持主音乐+背景音效双音轨混音

### 完整请求体

```json
{
  "images": {
    "urls": ["图片URL1", "图片URL2"],  // 必填（images或image二选一）- 支持JPG/PNG/GIF/WEBP
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "image": {
    "url": "图片URL",                  // 必填（images或image二选一）- 单图模式
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key",                  // 选填 - S3对象key
    "local_path": "本地文件路径"       // 选填 - 本地路径
  },
  "audio": {
    "urls": ["音频URL1", "音频URL2"],  // 必填 - 音频文件数组
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "sound_effects": {
    "urls": ["音效URL1", "音效URL2"],  // 选填 - 背景音效（雨声、咖啡厅氛围等）
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径",  // 选填 - 本地路径
    "volume": 0.3                      // 选填，默认0.3 - 音效音量（0-1）
  },
  "settings": {
    "video_length": 3600,              // 选填，默认3600 - 视频长度（秒）
    "framerate": 1,                    // 选填，默认1 - 帧率
    "loop_audio": true,                // 选填，默认true - 是否循环音频
    "music_volume": 1.0                // 选填，默认1.0 - 主音乐音量（0-1）
  },
  "output": {
    "cloud_upload": true,              // 选填，默认true - 是否上传到云端
    "filename": "lofi-video.mp4"       // 选填 - 输出文件名
  },
  "use_nvidia": true,                  // 选填，默认true - 是否使用GPU加速
  "webhook_url": "回调URL",            // 选填 - 任务完成回调地址
  "id": "任务ID"                       // 选填 - 自定义任务ID
}
```

### 说明
- **多图模式**: 使用 `images`，多张图片在视频时间轴上均分显示
- **单图模式**: 使用 `image`，单张图片循环显示整个视频时长
- **GIF支持**: GIF文件保持动画效果并循环播放
- **音效混音**: 主音乐和背景音效自动混合，可分别控制音量

---

## 2. 简单图片轮播视频

**接口路径**: `POST /v1/video/audio-with-images`

**功能**: 将多张图片按顺序轮播，配合音频和背景音乐生成视频

### 完整请求体

```json
{
  "images": {
    "urls": ["图片URL1", "图片URL2"],  // 必填 - 图片URL数组，支持JPG/PNG/GIF/WEBP
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "audio": {
    "url": "音频URL",                  // 必填 - 主音频
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key"                   // 选填 - S3对象key
  },
  "bg_music": {
    "url": "背景音乐URL",              // 选填 - 背景音乐
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key"                   // 选填 - S3对象key
  },
  "subtitles": "字幕SRT内容",          // 选填 - 字幕文本（SRT格式）
  "settings": {
    "image_duration": 10,              // 选填，默认10 - 每张图片显示时长（秒）
    "threads": 4,                      // 选填，默认4 - 处理线程数
    "use_nvidia": true,                // 选填，默认true - 是否使用GPU
    "num_images": 30,                  // 选填，默认30 - 使用图片数量
    "bg_music_volume": 0.4             // 选填，默认0.4 - 背景音乐音量（0-1）
  },
  "output": {
    "cloud_upload": true,              // 选填，默认true - 是否上传到云端
    "filename": "images_audio_video.mp4"  // 选填 - 输出文件名
  },
  "webhook_url": "回调URL",            // 选填 - 任务完成回调地址
  "id": "任务ID"                       // 选填 - 自定义任务ID
}
```

### 说明
- **GIF支持**: GIF文件保持动画效果循环播放到指定时长
- **随机选择**: 从提供的图片中随机选择指定数量（`num_images`）
- **视频长度**: 自动匹配音频长度，不足会循环视频

---

## 3. Ken Burns 动态效果视频

**接口路径**: `POST /v1/video/effects/ken-burns`

**功能**: 为图片添加动态缩放和平移效果（纪录片风格），支持转场和自动字幕

### 完整请求体

```json
{
  "images": {
    "urls": ["图片URL1", "图片URL2"],  // 必填 - 图片URL数组，支持JPG/PNG/GIF/WEBP
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "audio": {
    "url": "音频URL",                  // 必填 - 配音音频
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key"                   // 选填 - S3对象key
  },
  "background_music": {
    "url": "背景音乐URL",              // 选填 - 背景音乐
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key",                  // 选填 - S3对象key
    "volume": 0.2                      // 选填，默认0.2 - 背景音乐音量（0-1）
  },
  "settings": {
    "num_images": 100,                 // 选填，默认30 - 使用图片数量
    "magnify_factor": 0.6,             // 选填，默认0.5 - 放大系数（0.1-1.0，越小放大越多）
    "transition_effect": "fadeblack",  // 选填，默认"fadeblack" - 转场效果
    "transition_duration": 0.8,        // 选填，默认0.8 - 转场时长（秒）
    "fps": 24,                         // 选填，默认24 - 帧率
    "auto_subtitle": true,             // 选填，默认false - 是否自动生成字幕
    "subtitle_language": "en",         // 选填，默认"en" - 字幕语言
    "subtitle_task": "transcribe",     // 选填，默认"transcribe" - 字幕任务类型
    "subtitle_engine": "whisper"       // 选填，默认"whisper" - 字幕引擎
  },
  "output": {
    "cloud_upload": true,              // 选填，默认true - 是否上传到云端
    "filename": "ken-burns-video.mp4"  // 选填 - 输出文件名
  },
  "webhook_url": "回调URL",            // 选填 - 任务完成回调地址
  "id": "任务ID"                       // 选填 - 自定义任务ID
}
```

### 说明
- **GIF处理**: GIF文件自动提取第一帧应用动态效果
- **转场效果**: 支持 fadeblack, fade, wipeleft, wiperight, slideup, slidedown
- **字幕任务**: transcribe（识别）、translate（翻译为英文）

---

## 4. 静态幻灯片视频

**接口路径**: `POST /v1/video/static-slideshow`

**功能**: 创建静态图片幻灯片视频，支持淡入淡出转场效果

### 完整请求体

```json
{
  "images": {
    "urls": ["图片URL1", "图片URL2"],  // 必填 - 图片URL数组
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "audio": {
    "url": "音频URL",                  // 必填 - 背景音乐
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key"                   // 选填 - S3对象key
  },
  "settings": {
    "total_video_duration": 300,       // 选填，默认300 - 总视频时长（秒）
    "image_duration": 5.0,             // 选填，默认5.0 - 每张图片显示时长（秒）
    "transition": "fade"               // 选填，默认"none" - 转场效果（none/fade/slide）
  },
  "output": {
    "cloud_upload": true,              // 选填，默认true - 是否上传到云端
    "filename": "slideshow_video.mp4"  // 选填 - 输出文件名
  },
  "use_nvidia": true,                  // 选填，默认true - 是否使用GPU加速
  "webhook_url": "回调URL",            // 选填 - 任务完成回调地址
  "id": "任务ID"                       // 选填 - 自定义任务ID
}
```

### 说明
- **自动循环**: 图片不足会重复使用，直到达到总时长
- **音频循环**: 音频循环播放匹配视频长度
- **转场类型**: none（无转场）、fade（淡入淡出）、slide（滑动）

---

## 5. 视频蒙太奇

**接口路径**: `POST /v1/video/montage`

**功能**: 从多个视频中随机选择片段拼接成新视频，支持字幕和音频替换

### 完整请求体

```json
{
  "videos": {
    "urls": ["视频URL1", "视频URL2"],  // 必填 - 视频URL数组
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "folder_prefix": "文件夹前缀",     // 选填 - S3文件夹
    "local_folder": "本地文件夹路径"   // 选填 - 本地路径
  },
  "audio": {
    "url": "音频URL",                  // 必填 - 替换音频
    "bucket": "bucket名称",            // 选填 - S3存储桶
    "key": "对象key",                  // 选填 - S3对象key
    "local_path": "本地文件路径"       // 选填 - 本地路径
  },
  "subtitles": "字幕SRT内容",          // 选填 - 字幕文本（SRT格式）
  "auto_subtitle": false,              // 选填，默认false - 是否自动生成字幕
  "settings": {
    "num_videos": 5,                   // 选填，默认5 - 选择视频片段数量
    "clip_length": 5,                  // 选填，默认5 - 每个片段长度（秒）
    "shuffle": true,                   // 选填，默认true - 是否随机选择
    "loop_video": true,                // 选填，默认true - 视频不足是否循环
    "fps": 30,                         // 选填，默认30 - 输出帧率
    "burn_subtitles": true,            // 选填，默认true - 是否烧录字幕
    "subtitle_language": "zh",         // 选填，默认"zh" - 字幕语言
    "subtitle_task": "transcribe",     // 选填 - 字幕任务类型
    "subtitle_engine": "whisper"       // 选填 - 字幕引擎
  },
  "output": {
    "cloud_upload": true,              // 选填，默认true - 是否上传到云端
    "filename": "video_montage.mp4"    // 选填 - 输出文件名
  },
  "use_nvidia": true,                  // 选填，默认true - 是否使用GPU加速
  "webhook_url": "回调URL",            // 选填 - 任务完成回调地址
  "id": "任务ID"                       // 选填 - 自定义任务ID
}
```

### 说明
- **随机裁剪**: 从每个视频中随机位置裁剪指定长度
- **音频匹配**: 视频循环或裁剪以匹配音频长度
- **自动字幕**: 支持从音频自动生成字幕

---

## 支持的图片格式

| 格式 | lofi | audio-with-images | ken-burns | static-slideshow | montage |
|------|------|-------------------|-----------|------------------|---------|
| JPG  | ✅   | ✅                | ✅        | ✅               | N/A     |
| PNG  | ✅   | ✅                | ✅        | ✅               | N/A     |
| GIF  | ✅ 保持动画 | ✅ 保持动画  | ✅ 提取第一帧 | ✅         | N/A     |
| WEBP | ✅   | ✅                | ✅        | ✅               | N/A     |

---

## 通用说明

### 数据源配置（images/image/audio/videos）
每个数据源支持三种方式之一：
1. **URLs方式**: `urls` - URL数组
2. **S3方式**: `bucket` + `folder_prefix` 或 `bucket` + `key`
3. **本地方式**: `local_folder` 或 `local_path`

### 输出配置（output）
- `cloud_upload: true` - 上传到云端并返回URL
- `cloud_upload: false` - 返回本地路径
- `filename` - 自定义输出文件名

### 异步回调（webhook_url）
- 提供 `webhook_url` 后，任务在后台执行
- 完成后向该URL发送POST请求，包含结果

---

**文档版本**: v2.2  
**更新日期**: 2024-12-25
